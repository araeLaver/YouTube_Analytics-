<!-- ê³ ê¸‰ ë¶„ì„ ê¸°ëŠ¥ ì¶”ê°€ë¥¼ ìœ„í•œ HTML ì½”ë“œ -->

<!-- ë©”ì¸ ë¶„ì„ ê²°ê³¼ ì•„ë˜ì— ì¶”ê°€í•  ê³ ê¸‰ ê¸°ëŠ¥ ë²„íŠ¼ë“¤ -->
<div class="advanced-features-section">
    <h3 style="text-align: center; margin: 2rem 0; color: #667eea;">
        ğŸš€ AI ê¸°ë°˜ ê³ ê¸‰ ë¶„ì„ (NEW!)
    </h3>
    
    <div class="advanced-buttons">
        <button class="advanced-btn" onclick="loadKoreanTrends()" id="trendsBtn">
            ğŸ“ˆ í•œêµ­ì–´ íŠ¸ë Œë“œ ë¶„ì„
        </button>
        <button class="advanced-btn" onclick="getContentRecommendations()" id="contentBtn">
            ğŸ¯ AI ì½˜í…ì¸  ì¶”ì²œ
        </button>
        <button class="advanced-btn" onclick="analyzeSentiment()" id="sentimentBtn">
            ğŸ˜Š ëŒ“ê¸€ ê°ì • ë¶„ì„
        </button>
        <button class="advanced-btn" onclick="getAdvancedAnalytics()" id="advancedBtn">
            âš¡ ì¢…í•© ê³ ê¸‰ ë¶„ì„
        </button>
    </div>
</div>

<!-- ê³ ê¸‰ ë¶„ì„ ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
<div id="advancedResults" class="advanced-results" style="display: none;">
    <!-- ë™ì ìœ¼ë¡œ ë‚´ìš©ì´ ì¶”ê°€ë©ë‹ˆë‹¤ -->
</div>

<!-- ì¶”ê°€ CSS ìŠ¤íƒ€ì¼ -->
<style>
.advanced-features-section {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    padding: 2rem;
    border-radius: 20px;
    margin: 2rem 0;
    text-align: center;
}

.advanced-features-section h3 {
    color: white !important;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
}

.advanced-buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1.5rem;
}

.advanced-btn {
    background: rgba(255, 255, 255, 0.9);
    color: #333;
    border: none;
    padding: 1rem 1.5rem;
    border-radius: 15px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.advanced-btn:hover {
    background: white;
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
}

.advanced-btn:active {
    transform: translateY(-1px);
}

.advanced-results {
    margin-top: 2rem;
    padding: 2rem;
    background: #f8f9fa;
    border-radius: 20px;
    border: 2px solid #e9ecef;
}

.trend-card, .recommendation-card, .sentiment-card {
    background: white;
    padding: 1.5rem;
    border-radius: 15px;
    margin: 1rem 0;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.trend-keywords {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin: 1rem 0;
}

.keyword-tag {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 25px;
    font-size: 0.9rem;
    font-weight: 500;
}

.content-ideas {
    list-style: none;
    padding: 0;
}

.content-ideas li {
    background: #f8f9fa;
    padding: 1rem;
    margin: 0.5rem 0;
    border-radius: 10px;
    border-left: 4px solid #28a745;
}

.sentiment-chart {
    display: flex;
    justify-content: space-around;
    margin: 1rem 0;
    text-align: center;
}

.sentiment-item {
    flex: 1;
    padding: 1rem;
}

.sentiment-percentage {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
}

.positive { color: #28a745; }
.negative { color: #dc3545; }
.neutral { color: #6c757d; }

.loading-spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #667eea;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 20px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

<!-- JavaScript í•¨ìˆ˜ë“¤ -->
<script>
// ì „ì—­ ë³€ìˆ˜
let currentChannelData = null;
let currentVideosData = null;

// ì±„ë„ ë¶„ì„ í›„ ë°ì´í„° ì €ì¥
function storeAnalysisData(channelData, videosData) {
    currentChannelData = channelData;
    currentVideosData = videosData;
}

// í•œêµ­ì–´ íŠ¸ë Œë“œ ë¶„ì„
async function loadKoreanTrends() {
    const btn = document.getElementById('trendsBtn');
    const originalText = btn.textContent;
    btn.textContent = 'ë¶„ì„ ì¤‘...';
    btn.disabled = true;
    
    try {
        const response = await fetch('/api/korean_trends');
        const data = await response.json();
        
        if (data.error) {
            throw new Error(data.error);
        }
        
        displayTrends(data);
    } catch (error) {
        alert('íŠ¸ë Œë“œ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
    } finally {
        btn.textContent = originalText;
        btn.disabled = false;
    }
}

// AI ì½˜í…ì¸  ì¶”ì²œ
async function getContentRecommendations() {
    if (!currentChannelData) {
        alert('ë¨¼ì € ì±„ë„ ë¶„ì„ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”!');
        return;
    }
    
    const btn = document.getElementById('contentBtn');
    const originalText = btn.textContent;
    btn.textContent = 'ì¶”ì²œ ìƒì„± ì¤‘...';
    btn.disabled = true;
    
    try {
        const response = await fetch('/api/content_recommendations', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                category: 'ì¼ë°˜',
                subscriber_count: currentChannelData.subscriber_count || 0
            })
        });
        
        const data = await response.json();
        
        if (data.error) {
            throw new Error(data.error);
        }
        
        displayContentRecommendations(data);
    } catch (error) {
        alert('ì½˜í…ì¸  ì¶”ì²œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
    } finally {
        btn.textContent = originalText;
        btn.disabled = false;
    }
}

// ëŒ“ê¸€ ê°ì • ë¶„ì„
async function analyzeSentiment() {
    const btn = document.getElementById('sentimentBtn');
    const originalText = btn.textContent;
    btn.textContent = 'ê°ì • ë¶„ì„ ì¤‘...';
    btn.disabled = true;
    
    try {
        // ìƒ˜í”Œ ëŒ“ê¸€ë¡œ í…ŒìŠ¤íŠ¸
        const sampleComments = [
            "ì •ë§ ìœ ìš©í•œ ì˜ìƒì´ë„¤ìš”! ê°ì‚¬í•©ë‹ˆë‹¤",
            "ìµœê³ ì˜ˆìš”! êµ¬ë…í–ˆìŠµë‹ˆë‹¤",
            "ë„ì›€ì´ ë§ì´ ë˜ì—ˆì–´ìš”",
            "ë³„ë¡œë„¤ìš”... ì‹¤ë§",
            "ê·¸ëƒ¥ ê·¸ë˜ìš”",
            "ì™€ ëŒ€ë°•! ì§„ì§œ ì¢‹ì•„ìš”"
        ];
        
        const response = await fetch('/api/sentiment_analysis', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ comments: sampleComments })
        });
        
        const data = await response.json();
        
        if (data.error) {
            throw new Error(data.error);
        }
        
        displaySentimentAnalysis(data);
    } catch (error) {
        alert('ê°ì • ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
    } finally {
        btn.textContent = originalText;
        btn.disabled = false;
    }
}

// ì¢…í•© ê³ ê¸‰ ë¶„ì„
async function getAdvancedAnalytics() {
    if (!currentChannelData) {
        alert('ë¨¼ì € ì±„ë„ ë¶„ì„ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”!');
        return;
    }
    
    const btn = document.getElementById('advancedBtn');
    const originalText = btn.textContent;
    btn.textContent = 'ì¢…í•© ë¶„ì„ ì¤‘...';
    btn.disabled = true;
    
    try {
        const response = await fetch('/api/advanced_analytics', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                channel_data: currentChannelData,
                recent_videos: currentVideosData || []
            })
        });
        
        const data = await response.json();
        
        if (data.error) {
            throw new Error(data.error);
        }
        
        displayAdvancedAnalytics(data);
    } catch (error) {
        alert('ê³ ê¸‰ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
    } finally {
        btn.textContent = originalText;
        btn.disabled = false;
    }
}

// ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜ë“¤
function displayTrends(data) {
    const resultsDiv = document.getElementById('advancedResults');
    
    const html = `
        <div class="trend-card">
            <h4>ğŸ”¥ ì‹¤ì‹œê°„ í•œêµ­ì–´ íŠ¸ë Œë“œ</h4>
            <div class="trend-keywords">
                ${data.trending_keywords.map(keyword => 
                    `<span class="keyword-tag">${keyword}</span>`
                ).join('')}
            </div>
            
            <h5>ğŸ“ˆ ìƒìŠ¹ í† í”½</h5>
            <div class="trend-keywords">
                ${data.rising_topics.map(topic => 
                    `<span class="keyword-tag" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">${topic}</span>`
                ).join('')}
            </div>
        </div>
    `;
    
    resultsDiv.innerHTML = html;
    resultsDiv.style.display = 'block';
    resultsDiv.scrollIntoView({ behavior: 'smooth' });
}

function displayContentRecommendations(data) {
    const resultsDiv = document.getElementById('advancedResults');
    
    const html = `
        <div class="recommendation-card">
            <h4>ğŸ¯ AI ë§ì¶¤ ì½˜í…ì¸  ì¶”ì²œ</h4>
            <p><strong>ì „ëµ:</strong> ${data.strategy}</p>
            <p><strong>ìµœì  ì—…ë¡œë“œ ì‹œê°„:</strong> ${data.optimal_timing}</p>
            
            <h5>ğŸ’¡ ì¶”ì²œ ì½˜í…ì¸  ì•„ì´ë””ì–´</h5>
            <ul class="content-ideas">
                ${data.content_ideas.map(idea => 
                    `<li>ğŸ“ ${idea}</li>`
                ).join('')}
            </ul>
            
            <p><strong>ì¶”ì²œ í•´ì‹œíƒœê·¸:</strong> ${data.hashtag_suggestions.join(' ')}</p>
        </div>
    `;
    
    resultsDiv.innerHTML = html;
    resultsDiv.style.display = 'block';
    resultsDiv.scrollIntoView({ behavior: 'smooth' });
}

function displaySentimentAnalysis(data) {
    const resultsDiv = document.getElementById('advancedResults');
    
    const html = `
        <div class="sentiment-card">
            <h4>ğŸ˜Š ëŒ“ê¸€ ê°ì • ë¶„ì„</h4>
            <p>${data.summary}</p>
            
            <div class="sentiment-chart">
                <div class="sentiment-item">
                    <div class="sentiment-percentage positive">${data.positive}%</div>
                    <div>ğŸ˜Š ê¸ì •</div>
                </div>
                <div class="sentiment-item">
                    <div class="sentiment-percentage neutral">${data.neutral}%</div>
                    <div>ğŸ˜ ì¤‘ë¦½</div>
                </div>
                <div class="sentiment-item">
                    <div class="sentiment-percentage negative">${data.negative}%</div>
                    <div>ğŸ˜ ë¶€ì •</div>
                </div>
            </div>
            
            <p><small>ë¶„ì„ëœ ëŒ“ê¸€ ìˆ˜: ${data.total_analyzed}ê°œ</small></p>
        </div>
    `;
    
    resultsDiv.innerHTML = html;
    resultsDiv.style.display = 'block';
    resultsDiv.scrollIntoView({ behavior: 'smooth' });
}

function displayAdvancedAnalytics(data) {
    const resultsDiv = document.getElementById('advancedResults');
    
    const html = `
        <div style="display: grid; gap: 1rem;">
            <div class="trend-card">
                <h4>ğŸ”¥ íŠ¸ë Œë“œ ë¶„ì„</h4>
                <div class="trend-keywords">
                    ${data.trends.trending_keywords.map(keyword => 
                        `<span class="keyword-tag">${keyword}</span>`
                    ).join('')}
                </div>
            </div>
            
            <div class="recommendation-card">
                <h4>ğŸ¯ ì½˜í…ì¸  ì „ëµ</h4>
                <p><strong>${data.content_recommendations.strategy}</strong></p>
                <ul class="content-ideas">
                    ${data.content_recommendations.content_ideas.slice(0, 3).map(idea => 
                        `<li>ğŸ’¡ ${idea}</li>`
                    ).join('')}
                </ul>
            </div>
            
            <div class="sentiment-card">
                <h4>ğŸ“Š ì‹œì²­ì ë°˜ì‘</h4>
                <p>${data.sentiment_analysis.summary}</p>
                <div class="sentiment-chart">
                    <div class="sentiment-item">
                        <div class="sentiment-percentage positive">${data.sentiment_analysis.positive}%</div>
                        <div>ê¸ì •</div>
                    </div>
                    <div class="sentiment-item">
                        <div class="sentiment-percentage negative">${data.sentiment_analysis.negative}%</div>
                        <div>ë¶€ì •</div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    resultsDiv.innerHTML = html;
    resultsDiv.style.display = 'block';
    resultsDiv.scrollIntoView({ behavior: 'smooth' });
}
</script>